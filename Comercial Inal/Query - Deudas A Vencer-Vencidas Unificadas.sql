/*PRIMERO SE CREAN LAS DOS VISTAS DE LAS CONSULTAS DEFECTO DEL SISTEMA. HAY QUE IGUALAR LA CANTIDAD DE CONSULTAS QUE POSTERIORMENTE LA VISTA VA A TRAER YA QUE ENCONTRAMOS QUE AMBAS QUERYS NO TRAEN LAS MISMAS CANTIDAD DE COLUMNAS*/

--ACA SE CREA LA VISTA DE "DEUDAS A VENCER" PROPORCIONADA POR EL SISTEMA
Create View DeudasAVencer AS (
SELECT 
	CASE WHEN 'NO' = 'NO' THEN    CASE WHEN GVA46.FECHA_VTO = '01/01/1800' THEN NULL    ELSE        CASE WHEN GVA12.T_COMP <> 'FAC' THEN NULL        ELSE GVA46.FECHA_VTO        END    END ELSE     CASE dbo.fn_GetFechaVencimiento(DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())), GVA46.FECHA_VTO, GVA46.ALTERNATIVA_1, GVA46.ALTERNATIVA_2)         WHEN  1 THEN GVA46.FECHA_VTO         WHEN 11 THEN GVA46.FECHA_VTO         WHEN  2 THEN GVA46.ALTERNATIVA_1         WHEN 12 THEN GVA46.ALTERNATIVA_1         WHEN  3 THEN GVA46.ALTERNATIVA_2         WHEN 13 THEN GVA46.ALTERNATIVA_2     END END AS [Fecha de vencimiento] ,
	ISNULL(GVA46.T_COMP, GVA12.T_COMP) AS [Tipo comprobante] ,
	ISNULL(GVA46.N_COMP, GVA12.N_COMP) AS [Nro. comprobante] ,
	dbo.TLMostrarCodigoDescripcion(GVA12.COD_CLIENT, GVA14.RAZON_SOCI) AS [Cliente] ,
	GVA12.Cod_client AS [Cód. cliente] ,
	GVA14.COD_PROVIN AS [Cód. provincia] ,
	GVA18.NOMBRE_PRO AS [Nombre provincia] ,
	CASE WHEN ISNULL(GVA46.T_COMP, GVA12.T_COMP) <> 'FAC' THEN NULL ELSE CASE 'BICLAUSU' WHEN 'BIMONCTE' THEN SUM( CASE WHEN 'NO' = 'NO' THEN GVA46.IMPORTE_VT ELSE dbo.fn_GetImporteSegunFechaVencimiento(0, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END )	WHEN 'BICLAUSU' THEN SUM(CASE GVA14.CLAUSULA WHEN 0 THEN  CASE WHEN 'NO' = 'NO' THEN GVA46.IMPORTE_VT ELSE dbo.fn_GetImporteSegunFechaVencimiento(0, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE 0 END) ELSE 0 END END  AS [Importe al Vencimiento (CTE)] ,
	CASE WHEN ISNULL(GVA46.T_COMP, GVA12.T_COMP) <> 'FAC' THEN NULL ELSE CASE 'BICLAUSU' WHEN 'BIORIGEN' THEN  SUM(CASE WHEN GVA46.ESTADO_VTO <> 'PAG' THEN  CASE WHEN 'NO' = 'NO' THEN GVA46.IMP_VT_UNI ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE 0 END)  WHEN 'BICOTIZ' THEN  SUM(CASE WHEN GVA46.ESTADO_VTO <> 'PAG' THEN  CASE GVA14.CLAUSULA	WHEN 1 THEN	 CASE WHEN 'NO' = 'NO' THEN GVA46.IMP_VT_UNI ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE 0 END ELSE  DBO.SUMGVA12IMPORTES( 'BICOTIZ', GVA12.COTIZ, 1, CASE GVA14.CLAUSULA WHEN 1 THEN 'S' ELSE 'N' END,'S', GVA15.TIPO_COMP,  CASE GVA12.MON_CTE WHEN 1 THEN 'S' ELSE 'N' END,0,0,6,  CASE WHEN 'NO' = 'NO' THEN GVA46.IMP_VT_UNI ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  )  END )  WHEN 'BICLAUSU' THEN  SUM(CASE  WHEN GVA46.ESTADO_UNI <> 'PAG' THEN CASE GVA14.CLAUSULA WHEN 1 THEN  CASE WHEN 'NO' = 'NO' THEN GVA46.IMP_VT_UNI ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END   ELSE 0 END ELSE 0 END)  ELSE 0 END END  AS [Importe al Vencimiento (EXT)] ,
	CASE  ISNULL(GVA46.T_COMP, GVA12.T_COMP) WHEN 'FAC' THEN CASE 'BICLAUSU' WHEN 'BIMONCTE' THEN SUM(CASE WHEN ISNULL(IMPORTE_TRIPLE,0) = 0 THEN CASE WHEN 'NO' = 'NO' THEN GVA46.IMPORTE_VT ELSE dbo.fn_GetImporteSegunFechaVencimiento(0, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE    GVA46.IMPORTE_VT    +            (CASE WHEN ABS(ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(0, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                         GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                         GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                         GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMPORTE_VT, 0))                       - ABS(ISNULL(IMPORTE_TRIPLE, 0)) < 0 THEN 0                  ELSE                      ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(0, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                    GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                    GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                    GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMPORTE_VT, 0)                            - ISNULL(IMPORTE_TRIPLE, 0)             END)  END + ISNULL(IMPUTACIONES,0)) WHEN 'BICLAUSU' THEN SUM(CASE GVA14.CLAUSULA WHEN 0 THEN CASE WHEN ISNULL(IMPORTE_TRIPLE,0) = 0 THEN CASE WHEN 'NO' = 'NO' THEN GVA46.IMPORTE_VT ELSE dbo.fn_GetImporteSegunFechaVencimiento(0, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE    GVA46.IMPORTE_VT    +            (CASE WHEN ABS(ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(0, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                         GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                         GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                         GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMPORTE_VT, 0))                       - ABS(ISNULL(IMPORTE_TRIPLE, 0)) < 0 THEN 0                  ELSE                      ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(0, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                    GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                    GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                    GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMPORTE_VT, 0)                            - ISNULL(IMPORTE_TRIPLE, 0)             END)  END + isnull(IMPUTACIONES,0) ELSE 0 END)	ELSE 0 END WHEN 'REC' THEN CASE 'BICLAUSU' WHEN 'BIMONCTE' THEN SUM( GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS, 0))*-1 WHEN 'BICLAUSU' THEN SUM(CASE GVA14.CLAUSULA  WHEN 0 THEN GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS,0) ELSE 0 END)*-1 ELSE 0 END ELSE  CASE GVA15.TIPO_COMP WHEN 'D' THEN CASE 'BICLAUSU' WHEN 'BIMONCTE' THEN SUM( GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS, 0)) WHEN 'BICLAUSU' THEN SUM(CASE GVA14.CLAUSULA  WHEN 0 THEN GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS,0) ELSE 0 END) ELSE 0 END WHEN 'C' THEN CASE 'BICLAUSU' WHEN 'BIMONCTE' THEN SUM( GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS, 0))*-1 WHEN 'BICLAUSU' THEN SUM(CASE GVA14.CLAUSULA  WHEN 0 THEN GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS,0) ELSE 0 END)*-1 ELSE 0 END END END  AS [Importe Pendiente (CTE)] ,
	CASE  ISNULL(GVA46.T_COMP, GVA12.T_COMP) WHEN 'FAC' THEN CASE 'BICLAUSU' WHEN 'BIORIGEN' THEN SUM(CASE WHEN GVA46.ESTADO_VTO <> 'PAG' THEN CASE WHEN ISNULL(UNIDADES_TRIPLE,0) = 0 THEN CASE WHEN 'NO' = 'NO' THEN GVA46.IMP_VT_UNI ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE    GVA46.IMP_VT_UNI    +            (CASE WHEN ABS(ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(1, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                         GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                         GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                         GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMP_VT_UNI, 0))                       - ABS(ISNULL(impu.UNIDADES_TRIPLE, 0)) < 0 THEN 0                  ELSE                      ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(1, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                    GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                    GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                    GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMP_VT_UNI, 0)                            - ISNULL(UNIDADES_TRIPLE, 0)             END)  END  + ISNULL(IMPUTACIONES_UNI,0) ELSE 0 END) WHEN 'BICOTIZ' THEN SUM(CASE WHEN GVA46.ESTADO_VTO <> 'PAG' THEN CASE GVA14.CLAUSULA WHEN 1 THEN CASE WHEN ISNULL(UNIDADES_TRIPLE,0) = 0 THEN CASE WHEN 'NO' = 'NO' THEN GVA46.IMP_VT_UNI ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE    GVA46.IMP_VT_UNI    +            (CASE WHEN ABS(ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(1, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                         GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                         GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                         GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMP_VT_UNI, 0))                       - ABS(ISNULL(impu.UNIDADES_TRIPLE, 0)) < 0 THEN 0                  ELSE                      ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(1, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                    GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                    GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                    GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMP_VT_UNI, 0)                            - ISNULL(UNIDADES_TRIPLE, 0)             END)  END  + ISNULL(IMPUTACIONES_UNI,0) ELSE DBO.SUMGVA12IMPORTES( 'BICOTIZ' , GVA12.COTIZ, 1, CASE GVA14.CLAUSULA WHEN 1 THEN 'S' ELSE 'N' END,'S', GVA15.TIPO_COMP,  CASE GVA12.MON_CTE WHEN 1 THEN 'S' ELSE 'N' END,0,0,6, CASE WHEN ISNULL(IMPORTE_TRIPLE,0) = 0 THEN CASE WHEN 'NO' = 'NO' THEN GVA46.IMPORTE_VT ELSE dbo.fn_GetImporteSegunFechaVencimiento(0, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE    GVA46.IMPORTE_VT    +            (CASE WHEN ABS(ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(0, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                         GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                         GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                         GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMPORTE_VT, 0))                       - ABS(ISNULL(IMPORTE_TRIPLE, 0)) < 0 THEN 0                  ELSE                      ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(0, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                    GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                    GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                    GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMPORTE_VT, 0)                            - ISNULL(IMPORTE_TRIPLE, 0)             END)  END + ISNULL(IMPUTACIONES,0)) END ELSE 0 END) WHEN 'BICLAUSU' THEN SUM(CASE WHEN GVA46.ESTADO_UNI <> 'PAG' THEN CASE GVA14.CLAUSULA WHEN 1 THEN CASE WHEN ISNULL(UNIDADES_TRIPLE,0) = 0 THEN CASE WHEN 'NO' = 'NO' THEN GVA46.IMP_VT_UNI ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE    GVA46.IMP_VT_UNI    +            (CASE WHEN ABS(ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(1, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                         GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                         GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                         GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMP_VT_UNI, 0))                       - ABS(ISNULL(impu.UNIDADES_TRIPLE, 0)) < 0 THEN 0                  ELSE                      ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(1, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                    GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                    GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                    GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMP_VT_UNI, 0)                            - ISNULL(UNIDADES_TRIPLE, 0)             END)  END + ISNULL(IMPUTACIONES_UNI,0) ELSE 0 END ELSE 0 END) ELSE 0 END WHEN 'REC' THEN CASE 'BICLAUSU' WHEN 'BIORIGEN' THEN  SUM(GVA12.UNIDADES - ISNULL(impuotros.IMPUTACIONES_UNIotros, 0)) *-1 WHEN 'BICOTIZ' THEN  SUM(CASE GVA14.CLAUSULA  WHEN 1 THEN (GVA12.UNIDADES - ISNULL(IMPUOTROS.IMPUTACIONES_UNIOTROS, 0))*-1 ELSE dbo.SUMGVA12IMPORTES('BICOTIZ', GVA12.COTIZ, 1, CASE GVA14.CLAUSULA WHEN 1 THEN 'S' ELSE 'N' END, 'S', ISNULL(GVA15.TIPO_COMP,'C'),CASE GVA12.MON_CTE  WHEN 1 THEN 'S' ELSE 'N' END, 0, 0, 6, GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS, 0)) END) WHEN 'BICLAUSU' THEN  SUM(CASE GVA14.CLAUSULA WHEN 1 THEN GVA12.UNIDADES - ISNULL(IMPUOTROS.IMPUTACIONES_UNIOTROS, 0) ELSE 0 END ) *-1 ELSE 0 END ELSE CASE GVA15.TIPO_COMP WHEN 'D' THEN CASE 'BICLAUSU' WHEN 'BIORIGEN' THEN  SUM(GVA12.UNIDADES - ISNULL(impuotros.IMPUTACIONES_UNIotros, 0))  WHEN 'BICOTIZ' THEN  SUM(CASE GVA14.CLAUSULA  WHEN 1 THEN (GVA12.UNIDADES - ISNULL(IMPUOTROS.IMPUTACIONES_UNIOTROS, 0)) ELSE dbo.SUMGVA12IMPORTES('BICOTIZ', GVA12.COTIZ, 1, CASE GVA14.CLAUSULA WHEN 1 THEN 'S' ELSE 'N' END, 'S', ISNULL(GVA15.TIPO_COMP,'C'),CASE GVA12.MON_CTE  WHEN 1 THEN 'S' ELSE 'N' END, 0, 0, 6, GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS, 0)) END) WHEN 'BICLAUSU' THEN  SUM(CASE GVA14.CLAUSULA WHEN 1 THEN GVA12.UNIDADES - ISNULL(IMPUOTROS.IMPUTACIONES_UNIOTROS, 0) ELSE 0 END )  ELSE 0 END WHEN 'C' THEN  CASE 'BICLAUSU' WHEN 'BIORIGEN' THEN  SUM(GVA12.UNIDADES - ISNULL(impuotros.IMPUTACIONES_UNIotros, 0)) *-1 WHEN 'BICOTIZ' THEN  SUM(CASE GVA14.CLAUSULA  WHEN 1 THEN (GVA12.UNIDADES - ISNULL(IMPUOTROS.IMPUTACIONES_UNIOTROS, 0))*-1 ELSE dbo.SUMGVA12IMPORTES('BICOTIZ', GVA12.COTIZ, 1, CASE GVA14.CLAUSULA WHEN 1 THEN 'S' ELSE 'N' END, 'S', ISNULL(GVA15.TIPO_COMP,'C'),CASE GVA12.MON_CTE  WHEN 1 THEN 'S' ELSE 'N' END, 0, 0, 6, GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS, 0)) END) WHEN 'BICLAUSU' THEN  SUM(CASE GVA14.CLAUSULA WHEN 1 THEN GVA12.UNIDADES - ISNULL(IMPUOTROS.IMPUTACIONES_UNIOTROS, 0) ELSE 0 END ) *-1 ELSE 0 END END END  AS [Importe Pendiente (EXT)] ,
	GVA12.COD_VENDED AS [Cód. vendedor] ,
	CASE GVA12.COD_VENDED WHEN '**' THEN 'Carga inicial' ELSE GVA23.NOMBRE_VEN END AS [Nombre Vendedor] ,
	DATEDIFF(DAY, CASE WHEN GVA46.FECHA_VTO = '01/01/1800' THEN NULL ELSE GVA46.FECHA_VTO END, DATEDIFF(dd, 0, GETDATE())) AS [Días de atraso] ,
	GVA15.TIPO_COMP AS [GVA15.TIPO_COMP] ,
	CASE WHEN GVA15.CLASE_OPERACION = 'F' THEN 0 ELSE CASE WHEN GVA15.CLASE_OPERACION = 'NC' THEN 1 ELSE CASE WHEN GVA15.CLASE_OPERACION = 'ND' THEN 2 ELSE CASE WHEN GVA12.T_COMP = 'REC' THEN 3 ELSE 4 END END END END AS [ORDEN] 
FROM 
GVA12 
LEFT JOIN GVA46 ON GVA46.N_COMP = GVA12.N_COMP AND GVA46.T_COMP = GVA12.T_COMP 
INNER JOIN	GVA14 ON GVA14.COD_CLIENT = GVA12.COD_CLIENT 
LEFT JOIN GVA62 ON GVA62.GRUPO_EMPR =  GVA14.GRUPO_EMPR 
LEFT JOIN GVA23 ON GVA12.COD_VENDED = GVA23.COD_VENDED 
LEFT JOIN GVA24 ON GVA12.COD_TRANSP = GVA24.COD_TRANSP 
LEFT JOIN GVA05 ON GVA14.COD_ZONA = GVA05.COD_ZONA 
LEFT JOIN GVA18 ON GVA14.COD_PROVIN = GVA18.COD_PROVIN 
LEFT JOIN GVA133 ON GVA18.COD_PAIS = GVA133.COD_PAIS 
LEFT JOIN (SELECT DISTINCT COND_VTA, DESC_COND FROM GVA01) AS COND	ON COND.COND_VTA = GVA12.COND_VTA 
LEFT JOIN (            SELECT GVA07.T_COMP,            GVA07.N_COMP,            GVA07.FECHA_VTO,            SUM( CASE GVA07.T_COMP_CAN	WHEN 'REC' THEN - (GVA07.IMPORT_CAN)                      ELSE	CASE GVA15.TIPO_COMP WHEN 'D' THEN + (GVA07.IMPORT_CAN)                                 ELSE - (GVA07.IMPORT_CAN) END                      END) AS IMPUTACIONES,            SUM( CASE GVA07.T_COMP_CAN	WHEN 'REC' THEN - (GVA07.IMP_CAN_UN)                      ELSE CASE GVA15.TIPO_COMP WHEN 'D' THEN + (GVA07.IMP_CAN_UN)                                ELSE - (GVA07.IMP_CAN_UN) END                 END) AS IMPUTACIONES_UNI,                  SUM(	CASE GVA07.T_COMP_CAN	WHEN 'REC' THEN 0                             ELSE CASE WHEN GVA15.TIPO_COMP = 'D' AND GVA15.AJUSTE_FECHA_ALTERNATIVA = 'S' THEN + (GVA07.IMPORT_CAN)                                       ELSE CASE AJUSTE_FECHA_ALTERNATIVA WHEN 'S' THEN - (GVA07.IMPORT_CAN) ELSE 0 END                                  END	                       END) AS IMPORTE_TRIPLE,                  SUM(	CASE GVA07.T_COMP_CAN	WHEN 'REC' THEN 0                             ELSE CASE WHEN GVA15.TIPO_COMP = 'D' AND GVA15.AJUSTE_FECHA_ALTERNATIVA = 'S' THEN + (GVA07.IMP_CAN_UN)                                       ELSE CASE AJUSTE_FECHA_ALTERNATIVA WHEN 'S' THEN - (GVA07.IMP_CAN_UN) ELSE 0 END                                  END	                       END) AS UNIDADES_TRIPLE FROM	GVA07	
LEFT JOIN	GVA15 ON GVA15.IDENT_COMP = GVA07.T_COMP_CAN GROUP BY	GVA07.T_COMP,	GVA07.N_COMP,	GVA07.FECHA_VTO) as IMPU ON	IMPU.T_COMP = GVA12.T_COMP AND IMPU.N_COMP = GVA12.N_COMP AND IMPU.FECHA_VTO = GVA46.FECHA_VTO 
LEFT JOIN (            SELECT GVA07.T_COMP_CAN,            GVA07.N_COMP_CAN,            SUM(GVA07.IMPORT_CAN) AS IMPUTACIONESOTROS,            SUM(GVA07.IMP_CAN_UN) AS IMPUTACIONES_UNIOTROS FROM GVA07 GROUP BY GVA07.T_COMP_CAN, GVA07.N_COMP_CAN ) AS IMPUOTROS ON IMPUOTROS.N_COMP_CAN = GVA12.N_COMP AND IMPUOTROS.T_COMP_CAN = GVA12.T_COMP 
LEFT JOIN GVA15 ON GVA15.IDENT_COMP = GVA12.T_COMP 
LEFT JOIN SUCURSAL ON (GVA12.NRO_SUCURS = 0 AND SUCURSAL.NRO_SUCURSAL = (SELECT SUC.NRO_SUCURSAL FROM EMPRESA JOIN SUCURSAL SUC ON (EMPRESA.ID_SUCURSAL = SUC.ID_SUCURSAL))) OR GVA12.NRO_SUCURS = SUCURSAL.NRO_SUCURSAL left join empresa on 1=1 
LEFT JOIN GVA81 ON GVA81.COD_CLASIF = GVA12.COD_CLASIF   


WHERE 

((((GVA14.CLAUSULA = 0 AND GVA12.ESTADO = 'PEN') OR (GVA14.CLAUSULA = 1 AND GVA12.ESTADO_UNI = 'PEN')) AND   ((GVA14.CLAUSULA = 0 AND GVA46.ESTADO_VTO <> 'PAG') OR (GVA14.CLAUSULA = 1 AND GVA46.ESTADO_UNI <> 'PAG')) AND (GVA12.T_COMP = 'FAC')) AND     GVA46.FECHA_VTO >= DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())) OR   ((GVA12.T_COMP <> 'FAC') AND ((GVA14.CLAUSULA = 0 AND GVA12.ESTADO = 'CTA') OR (GVA14.CLAUSULA = 1 AND GVA12.ESTADO_UNI = 'CTA')))) 
 AND 
 GVA12.T_COMP IN ( 'FAC' ) 


GROUP BY 
	GVA46.FECHA_VTO, CASE WHEN 'NO' = 'NO' THEN    CASE WHEN GVA46.FECHA_VTO = '01/01/1800' THEN NULL    ELSE        CASE WHEN GVA12.T_COMP <> 'FAC' THEN NULL        ELSE GVA46.FECHA_VTO        END    END ELSE     CASE dbo.fn_GetFechaVencimiento(DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())), GVA46.FECHA_VTO, GVA46.ALTERNATIVA_1, GVA46.ALTERNATIVA_2)         WHEN  1 THEN GVA46.FECHA_VTO         WHEN 11 THEN GVA46.FECHA_VTO         WHEN  2 THEN GVA46.ALTERNATIVA_1         WHEN 12 THEN GVA46.ALTERNATIVA_1         WHEN  3 THEN GVA46.ALTERNATIVA_2         WHEN 13 THEN GVA46.ALTERNATIVA_2     END END , ISNULL(GVA46.T_COMP, GVA12.T_COMP) , ISNULL(GVA46.N_COMP, GVA12.N_COMP) , dbo.TLMostrarCodigoDescripcion(GVA12.COD_CLIENT, GVA14.RAZON_SOCI) , GVA12.Cod_client , GVA14.COD_PROVIN , GVA18.NOMBRE_PRO , GVA12.COD_VENDED , CASE GVA12.COD_VENDED WHEN '**' THEN 'Carga inicial' ELSE GVA23.NOMBRE_VEN END , GVA15.TIPO_COMP , CASE WHEN GVA15.CLASE_OPERACION = 'F' THEN 0 ELSE CASE WHEN GVA15.CLASE_OPERACION = 'NC' THEN 1 ELSE CASE WHEN GVA15.CLASE_OPERACION = 'ND' THEN 2 ELSE CASE WHEN GVA12.T_COMP = 'REC' THEN 3 ELSE 4 END END END END

)




--ACA SE CREA LA VISTA DE "DEUDAS VENCIDAS":
Create View DeudasVencidas AS (
SELECT 
	CASE WHEN 'NO' = 'NO' THEN    CASE WHEN GVA46.FECHA_VTO = '01/01/1800' THEN NULL    ELSE        CASE WHEN GVA12.T_COMP <> 'FAC' THEN NULL        ELSE GVA46.FECHA_VTO        END    END ELSE     CASE dbo.fn_GetFechaVencimiento(DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())), GVA46.FECHA_VTO, GVA46.ALTERNATIVA_1, GVA46.ALTERNATIVA_2)         WHEN  1 THEN GVA46.FECHA_VTO         WHEN 11 THEN GVA46.FECHA_VTO         WHEN  2 THEN GVA46.ALTERNATIVA_1         WHEN 12 THEN GVA46.ALTERNATIVA_1         WHEN  3 THEN GVA46.ALTERNATIVA_2         WHEN 13 THEN GVA46.ALTERNATIVA_2     END END AS [Fecha de vencimiento] ,
	GVA46.T_COMP AS [GVA46T_COMP] ,
	GVA12.T_COMP AS [GVA12T_COMP] ,
	ISNULL(GVA46.T_COMP, GVA12.T_COMP) AS [Tipo comprobante] ,
	ISNULL(GVA46.N_COMP, GVA12.N_COMP) AS [Nro. comprobante] ,
	GVA12.Cod_client AS [Cód. cliente] ,
	dbo.TLMostrarCodigoDescripcion(GVA12.COD_CLIENT, GVA14.RAZON_SOCI) AS [Cliente] ,
	GVA14.COD_ZONA AS [Cód. de Zona] ,
	GVA05.NOMBRE_ZON AS [Descripción Zona] ,
	GVA14.COD_PROVIN AS [Cód. provincia] ,
	GVA18.NOMBRE_PRO AS [Nombre provincia] ,
	CASE WHEN ISNULL(GVA46.T_COMP, GVA12.T_COMP) <> 'FAC' THEN NULL ELSE CASE 'BICLAUSU' WHEN 'BIMONCTE' THEN SUM( CASE WHEN 'NO' = 'NO' THEN GVA46.IMPORTE_VT  ELSE dbo.fn_GetImporteSegunFechaVencimiento(0, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2)  END )  WHEN 'BICLAUSU' THEN SUM(CASE GVA14.CLAUSULA WHEN 0 THEN  CASE WHEN 'NO' = 'NO' THEN GVA46.IMPORTE_VT  ELSE dbo.fn_GetImporteSegunFechaVencimiento(0, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2)  END  ELSE 0 END)  ELSE 0 END END  AS [Importe al Vencimiento (CTE)] ,
	CASE WHEN ISNULL(GVA46.T_COMP, GVA12.T_COMP) <> 'FAC' THEN NULL ELSE CASE 'BICLAUSU' WHEN 'BIORIGEN' THEN SUM(CASE WHEN GVA46.ESTADO_VTO <> 'PAG' THEN  CASE WHEN 'NO' = 'NO' THEN GVA46.IMP_VT_UNI  ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2)  END  ELSE 0 END)  WHEN 'BICOTIZ' THEN SUM(CASE WHEN GVA46.ESTADO_VTO <> 'PAG'THEN CASE GVA14.CLAUSULA WHEN 1 THEN  CASE WHEN 'NO' = 'NO' THEN GVA46.IMP_VT_UNI  ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2)  END  ELSE DBO.SUMGVA12IMPORTES( 'BICOTIZ', GVA12.COTIZ, 1, 'N','S', GVA15.TIPO_COMP,  CASE GVA12.MON_CTE WHEN 1 THEN 'S' ELSE 'N' END,0,0,6,  CASE WHEN 'NO' = 'NO' THEN GVA46.IMPORTE_VT  ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2)  END )  END  ELSE 0 END)WHEN 'BICLAUSU' THEN SUM(CASE WHEN GVA46.ESTADO_UNI <> 'PAG' THEN CASE GVA14.CLAUSULA WHEN 1 THEN CASE WHEN 'NO' = 'NO' THEN GVA46.IMP_VT_UNI ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END ELSE 0 END ELSE 0 END) ELSE 0 END END AS [Importe al Vencimiento (EXT)] ,
	CASE  ISNULL(GVA46.T_COMP, GVA12.T_COMP) WHEN 'FAC' THEN CASE 'BICLAUSU' WHEN 'BIMONCTE' THEN SUM(CASE WHEN ISNULL(IMPORTE_TRIPLE,0) = 0 THEN CASE WHEN 'NO' = 'NO' THEN GVA46.IMPORTE_VT ELSE dbo.fn_GetImporteSegunFechaVencimiento(0, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE    GVA46.IMPORTE_VT    +            (CASE WHEN ABS(ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(0, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                         GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                         GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                         GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMPORTE_VT, 0))                       - ABS(ISNULL(IMPORTE_TRIPLE, 0)) < 0 THEN 0                  ELSE                      ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(0, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                    GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                    GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                    GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMPORTE_VT, 0)                            - ISNULL(IMPORTE_TRIPLE, 0)             END)  END + ISNULL(IMPUTACIONES,0)) WHEN 'BICLAUSU' THEN SUM(CASE GVA14.CLAUSULA WHEN 0 THEN CASE WHEN ISNULL(IMPORTE_TRIPLE,0) = 0 THEN CASE WHEN 'NO' = 'NO' THEN GVA46.IMPORTE_VT ELSE dbo.fn_GetImporteSegunFechaVencimiento(0, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE    GVA46.IMPORTE_VT    +            (CASE WHEN ABS(ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(0, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                         GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                         GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                         GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMPORTE_VT, 0))                       - ABS(ISNULL(IMPORTE_TRIPLE, 0)) < 0 THEN 0                  ELSE                      ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(0, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                    GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                    GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                    GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMPORTE_VT, 0)                            - ISNULL(IMPORTE_TRIPLE, 0)             END)  END + isnull(IMPUTACIONES,0) ELSE 0 END)	ELSE 0 END WHEN 'REC' THEN CASE 'BICLAUSU' WHEN 'BIMONCTE' THEN SUM( GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS, 0))*-1 WHEN 'BICLAUSU' THEN SUM(CASE GVA14.CLAUSULA  WHEN 0 THEN GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS,0) ELSE 0 END)*-1 ELSE 0 END ELSE  CASE GVA15.TIPO_COMP WHEN 'D' THEN CASE 'BICLAUSU' WHEN 'BIMONCTE' THEN SUM( GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS, 0)) WHEN 'BICLAUSU' THEN SUM(CASE GVA14.CLAUSULA  WHEN 0 THEN GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS,0) ELSE 0 END) ELSE 0 END WHEN 'C' THEN CASE 'BICLAUSU' WHEN 'BIMONCTE' THEN SUM( GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS, 0))*-1 WHEN 'BICLAUSU' THEN SUM(CASE GVA14.CLAUSULA  WHEN 0 THEN GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS,0) ELSE 0 END)*-1 ELSE 0 END END END  AS [Importe Pendiente (CTE)] ,
	CASE  ISNULL(GVA46.T_COMP, GVA12.T_COMP) WHEN 'FAC' THEN CASE 'BICLAUSU' WHEN 'BIORIGEN' THEN SUM(CASE WHEN GVA46.ESTADO_VTO <> 'PAG' THEN CASE WHEN ISNULL(UNIDADES_TRIPLE,0) = 0 THEN CASE WHEN 'NO' = 'NO' THEN GVA46.IMP_VT_UNI ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE    GVA46.IMP_VT_UNI    +            (CASE WHEN ABS(ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(1, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                         GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                         GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                         GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMP_VT_UNI, 0))                       - ABS(ISNULL(impu.UNIDADES_TRIPLE, 0)) < 0 THEN 0                  ELSE                      ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(1, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                    GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                    GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                    GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMP_VT_UNI, 0)                            - ISNULL(UNIDADES_TRIPLE, 0)             END)  END  + ISNULL(IMPUTACIONES_UNI,0) ELSE 0 END) WHEN 'BICOTIZ' THEN SUM(CASE WHEN GVA46.ESTADO_VTO <> 'PAG' THEN CASE GVA14.CLAUSULA WHEN 1 THEN CASE WHEN ISNULL(UNIDADES_TRIPLE,0) = 0 THEN CASE WHEN 'NO' = 'NO' THEN GVA46.IMP_VT_UNI ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE    GVA46.IMP_VT_UNI    +            (CASE WHEN ABS(ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(1, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                         GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                         GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                         GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMP_VT_UNI, 0))                       - ABS(ISNULL(impu.UNIDADES_TRIPLE, 0)) < 0 THEN 0                  ELSE                      ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(1, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                    GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                    GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                    GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMP_VT_UNI, 0)                            - ISNULL(UNIDADES_TRIPLE, 0)             END)  END  + ISNULL(IMPUTACIONES_UNI,0) ELSE DBO.SUMGVA12IMPORTES( 'BICOTIZ' , GVA12.COTIZ, 1, CASE GVA14.CLAUSULA WHEN 1 THEN 'S' ELSE 'N' END,'S', GVA15.TIPO_COMP,  CASE GVA12.MON_CTE WHEN 1 THEN 'S' ELSE 'N' END,0,0,6, CASE WHEN ISNULL(IMPORTE_TRIPLE,0) = 0 THEN CASE WHEN 'NO' = 'NO' THEN GVA46.IMPORTE_VT ELSE dbo.fn_GetImporteSegunFechaVencimiento(0, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE    GVA46.IMPORTE_VT    +            (CASE WHEN ABS(ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(0, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                         GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                         GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                         GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMPORTE_VT, 0))                       - ABS(ISNULL(IMPORTE_TRIPLE, 0)) < 0 THEN 0                  ELSE                      ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(0, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                    GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                    GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                    GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMPORTE_VT, 0)                            - ISNULL(IMPORTE_TRIPLE, 0)             END)  END + ISNULL(IMPUTACIONES,0)) END ELSE 0 END) WHEN 'BICLAUSU' THEN SUM(CASE WHEN GVA46.ESTADO_UNI <> 'PAG' THEN CASE GVA14.CLAUSULA WHEN 1 THEN CASE WHEN ISNULL(UNIDADES_TRIPLE,0) = 0 THEN CASE WHEN 'NO' = 'NO' THEN GVA46.IMP_VT_UNI ELSE dbo.fn_GetImporteSegunFechaVencimiento(1, DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())), GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI, GVA46.ALTERNATIVA_1, GVA46.IMPORTE_TOTAL_1, GVA46.UNIDADES_TOTAL_1, GVA46.ALTERNATIVA_2, GVA46.IMPORTE_TOTAL_2, GVA46.UNIDADES_TOTAL_2) END  ELSE    GVA46.IMP_VT_UNI    +            (CASE WHEN ABS(ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(1, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                         GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                         GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                         GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMP_VT_UNI, 0))                       - ABS(ISNULL(impu.UNIDADES_TRIPLE, 0)) < 0 THEN 0                  ELSE                      ISNULL(dbo.fn_GetImporteSegunFechaVencimiento(1, Dateadd(dd, 0, Datediff(dd, 0, Getdate())),                                                                    GVA46.FECHA_VTO, GVA46.IMPORTE_VT, GVA46.IMP_VT_UNI,                                                                    GVA46.ALTERNATIVA_1, IMPORTE_TOTAL_1, UNIDADES_TOTAL_1,                                                                    GVA46.ALTERNATIVA_2, IMPORTE_TOTAL_2, UNIDADES_TOTAL_2) - GVA46.IMP_VT_UNI, 0)                            - ISNULL(UNIDADES_TRIPLE, 0)             END)  END + ISNULL(IMPUTACIONES_UNI,0) ELSE 0 END ELSE 0 END) ELSE 0 END WHEN 'REC' THEN CASE 'BICLAUSU' WHEN 'BIORIGEN' THEN  SUM(GVA12.UNIDADES - ISNULL(impuotros.IMPUTACIONES_UNIotros, 0)) *-1 WHEN 'BICOTIZ' THEN  SUM(CASE GVA14.CLAUSULA  WHEN 1 THEN (GVA12.UNIDADES - ISNULL(IMPUOTROS.IMPUTACIONES_UNIOTROS, 0))*-1 ELSE dbo.SUMGVA12IMPORTES('BICOTIZ', GVA12.COTIZ, 1, CASE GVA14.CLAUSULA WHEN 1 THEN 'S' ELSE 'N' END, 'S', ISNULL(GVA15.TIPO_COMP,'C'),CASE GVA12.MON_CTE  WHEN 1 THEN 'S' ELSE 'N' END, 0, 0, 6, GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS, 0)) END) WHEN 'BICLAUSU' THEN  SUM(CASE GVA14.CLAUSULA WHEN 1 THEN GVA12.UNIDADES - ISNULL(IMPUOTROS.IMPUTACIONES_UNIOTROS, 0) ELSE 0 END ) *-1 ELSE 0 END ELSE CASE GVA15.TIPO_COMP WHEN 'D' THEN CASE 'BICLAUSU' WHEN 'BIORIGEN' THEN  SUM(GVA12.UNIDADES - ISNULL(impuotros.IMPUTACIONES_UNIotros, 0))  WHEN 'BICOTIZ' THEN  SUM(CASE GVA14.CLAUSULA  WHEN 1 THEN (GVA12.UNIDADES - ISNULL(IMPUOTROS.IMPUTACIONES_UNIOTROS, 0)) ELSE dbo.SUMGVA12IMPORTES('BICOTIZ', GVA12.COTIZ, 1, CASE GVA14.CLAUSULA WHEN 1 THEN 'S' ELSE 'N' END, 'S', ISNULL(GVA15.TIPO_COMP,'C'),CASE GVA12.MON_CTE  WHEN 1 THEN 'S' ELSE 'N' END, 0, 0, 6, GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS, 0)) END) WHEN 'BICLAUSU' THEN  SUM(CASE GVA14.CLAUSULA WHEN 1 THEN GVA12.UNIDADES - ISNULL(IMPUOTROS.IMPUTACIONES_UNIOTROS, 0) ELSE 0 END )  ELSE 0 END WHEN 'C' THEN  CASE 'BICLAUSU' WHEN 'BIORIGEN' THEN  SUM(GVA12.UNIDADES - ISNULL(impuotros.IMPUTACIONES_UNIotros, 0)) *-1 WHEN 'BICOTIZ' THEN  SUM(CASE GVA14.CLAUSULA  WHEN 1 THEN (GVA12.UNIDADES - ISNULL(IMPUOTROS.IMPUTACIONES_UNIOTROS, 0))*-1 ELSE dbo.SUMGVA12IMPORTES('BICOTIZ', GVA12.COTIZ, 1, CASE GVA14.CLAUSULA WHEN 1 THEN 'S' ELSE 'N' END, 'S', ISNULL(GVA15.TIPO_COMP,'C'),CASE GVA12.MON_CTE  WHEN 1 THEN 'S' ELSE 'N' END, 0, 0, 6, GVA12.IMPORTE - ISNULL(IMPUTACIONESOTROS, 0)) END) WHEN 'BICLAUSU' THEN  SUM(CASE GVA14.CLAUSULA WHEN 1 THEN GVA12.UNIDADES - ISNULL(IMPUOTROS.IMPUTACIONES_UNIOTROS, 0) ELSE 0 END ) *-1 ELSE 0 END END END  AS [Importe Pendiente (EXT)] ,
	DATEDIFF(DAY, CASE WHEN GVA46.FECHA_VTO = '01/01/1800' THEN NULL ELSE GVA46.FECHA_VTO END, DATEDIFF(dd, 0, GETDATE())) AS [Días de atraso] ,
	GVA12.COD_VENDED AS [Cód. vendedor] ,
	CASE GVA12.COD_VENDED WHEN '**' THEN 'Carga inicial' ELSE GVA23.NOMBRE_VEN END AS [Nombre Vendedor],
	GVA15.TIPO_COMP AS [GVA15.TIPO_COMP] ,
	CASE WHEN GVA15.CLASE_OPERACION = 'F' THEN 0 ELSE CASE WHEN GVA15.CLASE_OPERACION = 'NC' THEN 1 ELSE CASE WHEN GVA15.CLASE_OPERACION = 'ND' THEN 2 ELSE CASE WHEN GVA12.T_COMP = 'REC' THEN 3 ELSE 4 END END END END AS [ORDEN] 
FROM 
 GVA12	 
LEFT JOIN GVA46 ON GVA46.N_COMP = GVA12.N_COMP AND GVA46.T_COMP = GVA12.T_COMP  
INNER JOIN GVA14 ON GVA14.COD_CLIENT = GVA12.COD_CLIENT  
LEFT JOIN	GVA23 ON GVA12.COD_VENDED = GVA23.COD_VENDED  
LEFT JOIN	GVA24 ON GVA12.COD_TRANSP = GVA24.COD_TRANSP  
LEFT JOIN	GVA05 ON GVA14.COD_ZONA = GVA05.COD_ZONA  
LEFT JOIN	GVA18 ON GVA14.COD_PROVIN = GVA18.COD_PROVIN  
LEFT JOIN GVA133 ON GVA18.COD_PAIS = GVA133.COD_PAIS  
LEFT JOIN (SELECT DISTINCT COND_VTA, DESC_COND FROM GVA01) AS COND ON COND.COND_VTA = GVA12.COND_VTA  
LEFT JOIN	GVA62 ON GVA62.GRUPO_EMPR =  GVA14.GRUPO_EMPR  
LEFT JOIN (             SELECT                  GVA07.T_COMP,                  GVA07.N_COMP,	                 GVA07.FECHA_VTO,                  SUM(	CASE GVA07.T_COMP_CAN	WHEN 'REC' THEN - (GVA07.IMPORT_CAN)                             ELSE CASE GVA15.TIPO_COMP WHEN 'D' THEN + (GVA07.IMPORT_CAN)                                       ELSE - (GVA07.IMPORT_CAN) END	                       END) AS IMPUTACIONES,                  SUM(	CASE GVA07.T_COMP_CAN	WHEN 'REC' THEN - (GVA07.IMP_CAN_UN)                             ELSE CASE GVA15.TIPO_COMP WHEN 'D' THEN + (GVA07.IMP_CAN_UN)                                       ELSE - (GVA07.IMP_CAN_UN) END                        END) AS IMPUTACIONES_UNI,                  SUM(	CASE GVA07.T_COMP_CAN	WHEN 'REC' THEN 0                             ELSE CASE WHEN GVA15.TIPO_COMP = 'D' AND GVA15.AJUSTE_FECHA_ALTERNATIVA = 'S' THEN + (GVA07.IMPORT_CAN)                                       ELSE CASE AJUSTE_FECHA_ALTERNATIVA WHEN 'S' THEN - (GVA07.IMPORT_CAN) ELSE 0 END                                  END	                       END) AS IMPORTE_TRIPLE,                  SUM(	CASE GVA07.T_COMP_CAN	WHEN 'REC' THEN 0                             ELSE CASE WHEN GVA15.TIPO_COMP = 'D' AND GVA15.AJUSTE_FECHA_ALTERNATIVA = 'S' THEN + (GVA07.IMP_CAN_UN)                                       ELSE CASE AJUSTE_FECHA_ALTERNATIVA WHEN 'S' THEN - (GVA07.IMP_CAN_UN) ELSE 0 END                                  END	                       END) AS UNIDADES_TRIPLE            FROM GVA07            
LEFT JOIN GVA15 ON GVA15.IDENT_COMP = GVA07.T_COMP_CAN           GROUP BY GVA07.T_COMP, GVA07.N_COMP, GVA07.FECHA_VTO          ) as IMPU ON IMPU.T_COMP = GVA12.T_COMP AND	IMPU.N_COMP = GVA12.N_COMP AND IMPU.FECHA_VTO = GVA46.FECHA_VTO  
LEFT JOIN (            SELECT GVA07.T_COMP_CAN,                GVA07.N_COMP_CAN,                SUM(GVA07.IMPORT_CAN) AS IMPUTACIONESOTROS,                SUM(GVA07.IMP_CAN_UN) AS IMPUTACIONES_UNIOTROS  FROM GVA07  GROUP BY GVA07.T_COMP_CAN, GVA07.N_COMP_CAN  ) AS IMPUOTROS ON IMPUOTROS.N_COMP_CAN = GVA12.N_COMP AND IMPUOTROS.T_COMP_CAN = GVA12.T_COMP 	
LEFT JOIN	GVA15 ON GVA15.IDENT_COMP = GVA12.T_COMP 
LEFT JOIN SUCURSAL ON (GVA12.NRO_SUCURS = 0 AND SUCURSAL.NRO_SUCURSAL = (SELECT SUC.NRO_SUCURSAL FROM EMPRESA JOIN SUCURSAL SUC ON (EMPRESA.ID_SUCURSAL = SUC.ID_SUCURSAL))) OR GVA12.NRO_SUCURS = SUCURSAL.NRO_SUCURSAL  left join empresa on 1=1  
LEFT JOIN GVA81 ON GVA81.COD_CLASIF = GVA12.COD_CLASIF                                 


WHERE 

 ((((GVA14.CLAUSULA = 0 AND GVA12.ESTADO = 'PEN') OR (GVA14.CLAUSULA = 1 AND GVA12.ESTADO_UNI = 'PEN')) AND    ((GVA14.CLAUSULA = 0 AND GVA46.ESTADO_VTO <> 'PAG') OR (GVA14.CLAUSULA = 1 AND GVA46.ESTADO_UNI <> 'PAG')) AND (GVA12.T_COMP = 'FAC')) AND      GVA46.FECHA_VTO  < DATEADD(dd, 0, DATEDIFF(dd, 0, getdate())) OR    ((GVA12.T_COMP <> 'FAC') AND ((GVA14.CLAUSULA = 0 AND GVA12.ESTADO = 'CTA') OR (GVA14.CLAUSULA = 1 AND GVA12.ESTADO_UNI = 'CTA')))) 
 AND 
 GVA12.T_COMP IN ( 'FAC' ) 


GROUP BY 
	CASE WHEN 'NO' = 'NO' THEN    CASE WHEN GVA46.FECHA_VTO = '01/01/1800' THEN NULL    ELSE        CASE WHEN GVA12.T_COMP <> 'FAC' THEN NULL        ELSE GVA46.FECHA_VTO        END    END ELSE     CASE dbo.fn_GetFechaVencimiento(DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())), GVA46.FECHA_VTO, GVA46.ALTERNATIVA_1, GVA46.ALTERNATIVA_2)         WHEN  1 THEN GVA46.FECHA_VTO         WHEN 11 THEN GVA46.FECHA_VTO         WHEN  2 THEN GVA46.ALTERNATIVA_1         WHEN 12 THEN GVA46.ALTERNATIVA_1         WHEN  3 THEN GVA46.ALTERNATIVA_2         WHEN 13 THEN GVA46.ALTERNATIVA_2     END END , GVA46.T_COMP , GVA12.T_COMP , ISNULL(GVA46.T_COMP, GVA12.T_COMP) , ISNULL(GVA46.N_COMP, GVA12.N_COMP) , GVA12.Cod_client , dbo.TLMostrarCodigoDescripcion(GVA12.COD_CLIENT, GVA14.RAZON_SOCI) , GVA14.COD_ZONA , GVA05.NOMBRE_ZON , GVA18.NOMBRE_PRO , DATEDIFF(DAY, CASE WHEN GVA46.FECHA_VTO = '01/01/1800' THEN NULL ELSE GVA46.FECHA_VTO END, DATEDIFF(dd, 0, GETDATE())) , GVA12.COD_VENDED , GVA14.COD_PROVIN, GVA23.NOMBRE_VEN, GVA15.TIPO_COMP , CASE WHEN GVA15.CLASE_OPERACION = 'F' THEN 0 ELSE CASE WHEN GVA15.CLASE_OPERACION = 'NC' THEN 1 ELSE CASE WHEN GVA15.CLASE_OPERACION = 'ND' THEN 2 ELSE CASE WHEN GVA12.T_COMP = 'REC' THEN 3 ELSE 4 END END END END
)

/* SE AGREGA UNA COLUMNA LLAMADA: "A VENCER/VENCIDA" PARA QUE PODAMOS VER AL LADO DE [DIAS ATRASO] SI EL COMPROBANTE ESTA VENCIDO O PROXIMO A VENCER*/

SELECT 
    [CLIENTE], 
	CASE 
        WHEN ISNUMERIC([CÓD. CLIENTE]) = 1 THEN CAST([CÓD. CLIENTE] AS INT)
        ELSE NULL  -- O cualquier otro valor predeterminado que desees para no numéricos
    END AS [CÓD. CLIENTE], 
    [TIPO COMPROBANTE], 
    [NRO. COMPROBANTE], 
    [FECHA DE VENCIMIENTO], 
    CASE 
        WHEN ISNUMERIC([CÓD. PROVINCIA]) = 1 THEN CAST([CÓD. PROVINCIA] AS INT)
        ELSE NULL  -- O cualquier otro valor predeterminado que desees para no numéricos
    END AS [CÓD. PROVINCIA], 
    [NOMBRE PROVINCIA], 
    [IMPORTE AL VENCIMIENTO (CTE)], 
    [IMPORTE AL VENCIMIENTO (EXT)], 
    [IMPORTE PENDIENTE (CTE)], 
    [IMPORTE PENDIENTE (EXT)], 
    CASE 
        WHEN ISNUMERIC([CÓD. VENDEDOR]) = 1 THEN CAST([CÓD. VENDEDOR] AS INT)
        ELSE NULL  -- O cualquier otro valor predeterminado que desees para no numéricos
    END AS [CÓD. VENDEDOR], 
    [NOMBRE VENDEDOR], 
    CAST([DÍAS DE ATRASO] AS INT) AS [DÍAS DE ATRASO],
    CASE 
        WHEN CAST([DÍAS DE ATRASO] AS INT) < 0 THEN 'A vencer'
        ELSE 'Vencida'
    END AS [Estado]
FROM 
    (SELECT 
        [CLIENTE], 
        	CASE 
        WHEN ISNUMERIC([CÓD. CLIENTE]) = 1 THEN CAST([CÓD. CLIENTE] AS INT)
        ELSE NULL  -- O cualquier otro valor predeterminado que desees para no numéricos
    END AS [CÓD. CLIENTE],
        [TIPO COMPROBANTE], 
        [NRO. COMPROBANTE], 
        [FECHA DE VENCIMIENTO], 
        CASE 
            WHEN ISNUMERIC([CÓD. PROVINCIA]) = 1 THEN CAST([CÓD. PROVINCIA] AS INT)
            ELSE NULL  -- O cualquier otro valor predeterminado que desees para no numéricos
        END AS [CÓD. PROVINCIA], 
        [NOMBRE PROVINCIA], 
        [IMPORTE AL VENCIMIENTO (CTE)], 
        [IMPORTE AL VENCIMIENTO (EXT)], 
        [IMPORTE PENDIENTE (CTE)], 
        [IMPORTE PENDIENTE (EXT)], 
        CASE 
            WHEN ISNUMERIC([CÓD. VENDEDOR]) = 1 THEN CAST([CÓD. VENDEDOR] AS INT)
            ELSE NULL  -- O cualquier otro valor predeterminado que desees para no numéricos
        END AS [CÓD. VENDEDOR], 
        [NOMBRE VENDEDOR], 
        CAST([DÍAS DE ATRASO] AS INT) AS [DÍAS DE ATRASO]
    FROM DEUDASVENCIDAS
    
    UNION ALL
    
    SELECT 
        [CLIENTE], 
        	CASE 
        WHEN ISNUMERIC([CÓD. CLIENTE]) = 1 THEN CAST([CÓD. CLIENTE] AS INT)
        ELSE NULL  -- O cualquier otro valor predeterminado que desees para no numéricos
    END AS [CÓD. CLIENTE],
        [TIPO COMPROBANTE], 
        [NRO. COMPROBANTE], 
        [FECHA DE VENCIMIENTO], 
        CASE 
            WHEN ISNUMERIC([CÓD. PROVINCIA]) = 1 THEN CAST([CÓD. PROVINCIA] AS INT)
            ELSE NULL  -- O cualquier otro valor predeterminado que desees para no numéricos
        END AS [CÓD. PROVINCIA], 
        [NOMBRE PROVINCIA], 
        [IMPORTE AL VENCIMIENTO (CTE)], 
        [IMPORTE AL VENCIMIENTO (EXT)], 
        [IMPORTE PENDIENTE (CTE)], 
        [IMPORTE PENDIENTE (EXT)], 
        CASE 
            WHEN ISNUMERIC([CÓD. VENDEDOR]) = 1 THEN CAST([CÓD. VENDEDOR] AS INT)
            ELSE NULL  -- O cualquier otro valor predeterminado que desees para no numéricos
        END AS [CÓD. VENDEDOR], 
        [NOMBRE VENDEDOR], 
        CAST([DÍAS DE ATRASO] AS INT) AS [DÍAS DE ATRASO]
    FROM DEUDASAVENCER) AS CombinedTable;

